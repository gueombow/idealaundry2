<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IDEALAUNDRY</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{
  font-family:monospace;
  background:#f4f4f4;
  padding:10px;
}

#nota{
  width:340px;
  background:#fff;
  padding:10px;
  margin:auto;
  border:1px solid #000;
}

h2{
  text-align:center;
  margin:5px 0;
}

table{
  width:100%;
  font-size:12px;
  border-collapse:collapse;
}

td,th{
  padding:3px;
}

th{
  border-bottom:1px solid #000;
}

.right{
  text-align:right;
}

input, select{
  width:100%;
  font-family:monospace;
  font-size:12px;
  margin-bottom:4px;
}

button{
  width:340px;
  padding:8px;
  margin:5px auto;
  display:block;
  font-family:monospace;
}
.small-btn{
  width:100%;
  padding:4px;
  font-size:11px;
}
hr{
  border:0;
  border-top:1px dashed #000;
}
</style>
</head>

<body>

<div id="nota">

<h2>IDEALAUNDRY</h2>
<center>HP: 085179578282</center>
<hr>

<table>
<tr>
<td>No Nota</td>
<td class="right" id="noNota"></td>
</tr>
</table>

<hr>

Nama:
<input type="text">

No Telp:
<input type="text">

Alamat:
<input type="text">

<hr>

Tanggal Masuk:
<input type="datetime-local" id="tglMasuk" onchange="updateSemua()">

Tanggal Selesai:
<input type="date" id="tglSelesai">

<hr>

<b>LAUNDRY KILOAN</b>

<select id="layananKiloan" onchange="updateSemua()">
<option value="">-- Pilih Layanan --</option>

<option value="5000|2">Setrika (2 Hari) - 5.000/kg</option>
<option value="10000|0">Cuci Lipat Express 6 Jam - 10.000/kg</option>
<option value="8000|1">Cuci Lipat 1 Hari - 8.000/kg</option>

<option value="7000|3">Cuci (3 Hari) - 7.000/kg</option>
<option value="9000|2">Cuci + Setrika (2 Hari) - 9.000/kg</option>
<option value="12000|1">Express (1 Hari) - 12.000/kg</option>

</select>

</select>

Berat (kg):
<input type="number" id="berat" oninput="updateSemua()">

<table>
<tr>
<td>Subtotal Kiloan</td>
<td class="right" id="subKiloan">Rp 0</td>
</tr>
</table>

<hr>

<b>LAUNDRY SATUAN</b>

<table id="tableSatuan">
<thead>
<tr>
<th>Item</th>
<th>Harga</th>
<th></th>
</tr>
</thead>
<tbody id="bodySatuan">
<tr>
<td><input type="text" oninput="updateSemua()"></td>
<td><input type="number" oninput="updateSemua()"></td>
<td><button class="small-btn" onclick="hapusItem(this)">X</button></td>
</tr>
</tbody>
</table>

<button class="small-btn" onclick="tambahItem()">+ Tambah Item</button>

<table>
<tr>
<td>Subtotal Satuan</td>
<td class="right" id="subSatuan">Rp 0</td>
</tr>
</table>

<hr>

<table>
<tr>
<td><b>TOTAL</b></td>
<td class="right"><b id="total">Rp 0</b></td>
</tr>
</table>

<hr>
<center>Terima Kasih üôè</center>

</div>

<button onclick="exportJPG()">EXPORT JPG</button>

<script>

function formatRupiah(n){
  return "Rp " + n.toLocaleString("id-ID");
}

function generateNoNota(){
  const d = new Date();
  return "IL-" +
    d.getFullYear() +
    (d.getMonth()+1).toString().padStart(2,"0") +
    d.getDate().toString().padStart(2,"0") +
    d.getHours().toString().padStart(2,"0") +
    d.getMinutes().toString().padStart(2,"0") +
    d.getSeconds().toString().padStart(2,"0");
}

document.getElementById("noNota").innerText = generateNoNota();

const now = new Date();
document.getElementById("tglMasuk").value = now.toISOString().slice(0,16);

function tambahItem(){
  const tbody = document.getElementById("bodySatuan");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" oninput="updateSemua()"></td>
    <td><input type="number" oninput="updateSemua()"></td>
    <td><button class="small-btn" onclick="hapusItem(this)">X</button></td>
  `;
  tbody.appendChild(row);
}

function hapusItem(btn){
  btn.parentElement.parentElement.remove();
  updateSemua();
}

function updateSemua(){

  const layanan = document.getElementById("layananKiloan").value;
  const berat = parseFloat(document.getElementById("berat").value) || 0;

  let subKiloan = 0;
  let subSatuan = 0;

  if(layanan !== ""){
    const data = layanan.split("|");
    const harga = parseFloat(data[0]);
    const hari = parseInt(data[1]);

    subKiloan = harga * berat;

    const tglMasuk = document.getElementById("tglMasuk").value;
    if(tglMasuk){
      const selesai = new Date(tglMasuk);
      selesai.setDate(selesai.getDate() + hari);
      document.getElementById("tglSelesai").value =
        selesai.toISOString().slice(0,10);
    }
  }

  const rows = document.querySelectorAll("#bodySatuan tr");
  rows.forEach(row=>{
    const harga = parseFloat(row.cells[1].querySelector("input").value) || 0;
    subSatuan += harga;
  });

  const total = subKiloan + subSatuan;

  document.getElementById("subKiloan").innerText = formatRupiah(subKiloan);
  document.getElementById("subSatuan").innerText = formatRupiah(subSatuan);
  document.getElementById("total").innerText = formatRupiah(total);
}

function exportJPG(){
  html2canvas(document.getElementById("nota")).then(canvas=>{
    const link=document.createElement("a");
    link.download="nota_idealaundry.jpg";
    link.href=canvas.toDataURL("image/jpeg",0.95);
    link.click();
  });
}

updateSemua();

</script>

</body>
</html>

